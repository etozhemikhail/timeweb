pipeline {
    agent any

    parameters {
        string(name: 'nexusArchiveUrl', defaultValue: '', description: 'Link to Nexus archive')
        string(name: 'gitRepoUrl', defaultValue: '', description: 'Git repository URL')
    }

    stages {
        stage('Checkout and Generate parameters') {
            steps {
                git {
                    remote {
                        url("${gitRepoUrl}")
                        credentialsId('your-credentials-id')
                    }
                    branch('main')
                }
                script {
                    dir('helms') {
                        def params = [:]
                        def dirs = fileTree(dir: '.', excludes: ['**/.svn', '**/.git'])
                        dirs.each { dir ->
                            def appName = dir.name
                            params["url-${appName}"] = [string(name: "url-${appName}", defaultValue: '', description: "URL for ${appName}")]
                            params["deploy-url-${appName}"] = [booleanParam(name: "deploy-url-${appName}", defaultValue: false, description: "Deploy ${appName}?")]
                        }
                        params['nexusArchiveUrl'] = [string(name: 'nexusArchiveUrl', defaultValue: '', description: 'Link to Nexus archive')]
                        pipelineParameters(params)
                    }
                }
            }
        }
    }
}