pipeline {
    agent any

    environment {
        GIT_CREDENTIALS_ID = 'your-credentials-id'
        HELMS_DIR = 'helms'
    }

    parameters {
        string(name: 'nexusArchiveUrl', defaultValue: '', description: 'Link to Nexus archive')
    }

    stages {
        stage('Checkout and Generate parameters') {
            steps {
                checkout scm
                script {
                    def dirs = findFiles(glob: "${HELMS_DIR}/**/").collect { it.getParent().getName() }.unique()
                    def params = [:]
                    dirs.each { dir ->
                        def appName = dir
                        params["url-${appName}"] = ''
                        params["deploy-url-${appName}"] = false
                    }
                    params['nexusArchiveUrl'] = ''
                    properties([
                        parameters([
                            string(name: 'nexusArchiveUrl', defaultValue: '', description: 'Link to Nexus archive')
                        ])
                    ])
                    dirs.each { dir ->
                        def appName = dir
                        properties([
                            parameters([
                                string(name: "url-${appName}", defaultValue: '', description: "URL for ${appName}"),
                                booleanParam(name: "deploy-url-${appName}", defaultValue: false, description: "Deploy ${appName}?")
                            ])
                        ])
                    }
                }
            }
        }
    }
}