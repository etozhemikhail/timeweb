pipeline {
    agent any

    parameters {
        string(name: 'nexusArchiveUrl', defaultValue: '', description: 'Link to Nexus archive')
    }

    stages {
        stage('Generate parameters') {
            steps {
                dir('helms') {
                    def params = [:]
                    dirs = findFiles(glob: '*/')
                    dirs.each { dir ->
                        def appName = dir.name
                        params["url-${appName}"] = string(name: "url-${appName}", defaultValue: '', description: "URL for ${appName}")
                        params["deploy-url-${appName}"] = booleanParam(name: "deploy-url-${appName}", defaultValue: false, description: "Deploy ${appName}?")
                    }
                    properties(params)
                }
            }
        }
    }
}